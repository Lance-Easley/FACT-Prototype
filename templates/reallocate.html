<!-- Transfer Form -->

{% extends 'base.html' %}

{% block title %}FACT Pending{% endblock title %}

{% block content %}
<button class="btn btn-primary" onclick="window.history.back()">BACK</button>
<div id="__queueform">
  <h1 style="text-align: center;">REALLOCATE REMAINING</h1>
    <div class="info-field">
      <p style="text-align: center;"><b>Weight: {{ form.contract_weight_left }}</p>
    </div>
  </section>

  <form method="POST">
    {% csrf_token %}
    <table style="margin:auto">
      {% for field in form %}
        <div class="container-control-container">
          <tr class="container-control">
            <td>{{ field.label_tag }}</td>
            <td>{{ field }}</td>
            <td><input type="number" class="percent-control" step="any">%</td>
          </tr>
        </div>
      {% endfor %}
    </table>
    <button style="font-size: 2rem; margin: auto">Transfer</button>
  </form>
  <script>
    const controlContainer = document.querySelector(
      ".container-control-container"
    );
    const totalWeight = {{ form.from_container_weight }};
    const controls = document.querySelectorAll(".container-control");
    
    for (const control of controls) { 
      const percentInput = control.querySelector(
      ".percent-control"
      );
      const weightInput = control.querySelector("input[name]");
      weightInput.addEventListener("input", () => {
        percentInput.value = ((Number(weightInput.value) / totalWeight) * 100).toFixed(3);
      });
      percentInput.value = ((Number(weightInput.value) / totalWeight) * 100).toFixed(3);
      percentInput.addEventListener("input", () => {
        weightInput.value = Math.round((totalWeight * Number(percentInput.value)) / 100);
      });
    }
  </script>
</div>
{% endblock %}
