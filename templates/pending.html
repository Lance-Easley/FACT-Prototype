<!-- Summary of Transfers with Pending Changes -->

{% extends 'base.html' %}

{% block title %}FACT Pending{% endblock title %}

{% block content %}

<!-- contract information -->
<div id="__pending">
  <h1 id="title" class="text-center">FACT - Cargo Transfer PENDING</h1>
  <section id="contract-info">
    <div class="info-field">
      <p><b>Contract NO.:</b></p>
      <p>{{ contract.contract_number }}</p>
    </div>
    <div class="info-field">
      <p><b>Total Weight:</b></p>
      <p>{{ contract.total_weight }}</p>
    </div>
    <div class="info-field">
      <p><b>Product CO.:</b></p>
      <p>{{ contract.company_code }}</p>
    </div>
    <div class="info-field">
      <p><b>Contract Date:</b></p>
      <p>{{ contract.contract_date }}</p>
    </div>
    <div class="info-field">
      <p><b>Product:</b></p>
      <p>{{ contract.product }}</p>
    </div>
    <div class="info-field">
      <p><b>Restrictions:</b></p>
      <p>{{contract.restrictions}}</p>
    </div>
    <div class="info-field">
      <p><b>Operator:</b></p>
      <p>{{ contract.operator }}</p>
    </div>
  </section>
  <div class="border-line"></div>

<!--Current Containers -->
  
<section id="current-containers">
  <div id="current-containers-parts">
    <div class="container-headers">
      <p><b>Current Containers</b></p>
      <p></p>
      <p></p>
      <p class="align-end"><b>Tare WT</b></p>
      <p class="align-end"><b>DISTR</b></p>
      <p class="align-center"><b>XFR</b></p>
    </div>
    {% for master_container in contract.curr_containers %}
      {% for container in master_container.distribution %}
        <div class="container-info curr-containers">
          <p>{{ container.container }}</p>
          <p><a href="https://images.sampleforms.com/wp-content/uploads/2016/11/Blank-Bill-of-Lading-Form.jpg">BL144</a></p>
          <p><a href="https://www.pdffiller.com/preview/0/967/967335/large.png">COC</a></p>
          <p class="align-end curr-container-weight">{{ container.weight }}</p>
          <p class="align-end curr-container-percent"></p>
          <p class="align-center">
            <a href="{% url 'queue' contract.id container.container|urlencode:"" %}">Edit</a>
          </p>
        </div>
      {% endfor %}
    {% endfor %}
    <!-- <pre>{{ contract.curr_containers }}</pre> -->
</div>
<div class="border-line"></div>
</section>

  <!-- Pending Containers -->

      <section id="pending-containers" class="text-red">
        <div id="pending-containers-parts">
          <div class="container-headers">
            <p><b>Pending Containers</b></p>
            <p></p>
            <p></p>
            <p class="align-end"><b>Tare WT</b></p>
            <p class="align-end"><b>DISTR</b></p>
          </div>
          {% for master_container in contract.pend_containers %}
            {% for container in master_container.distribution %}
              {% if container.weight == 0 %}
                {% for master_container in contract.curr_containers %}
                  {% for c_container in master_container.distribution %}
                    {% if container.container == c_container.container %}
                      <div class="container-info pend-containers">
                        <p>{{ container.container }}</p>
                        <p><a href="https://images.sampleforms.com/wp-content/uploads/2016/11/Blank-Bill-of-Lading-Form.jpg">BL144</a></p>
                        <p><a href="https://www.pdffiller.com/preview/0/967/967335/large.png">COC</a></p>
                        <p class="align-end pend-container-weight">{{ container.weight }}</p>
                        <p class="align-end pend-container-percent"></p>
                      </div>
                    {% endif %}
                  {% endfor%}
                {% endfor%}
              {% else %}
                <div class="container-info pend-containers">
                  <p>{{ container.container }}</p>
                  <p><a href="#">BL144</a></p>
                  <p><a href="#">COC</a></p>
                  <p class="align-end pend-container-weight">{{ container.weight }}</p>
                  <p class="align-end pend-container-percent"></p>
                </div>
              {% endif %}
            {% endfor %}
          {% endfor %}
          <!-- <pre>{{ contract.curr_containers }}</pre> -->
      </div>
    </section>

    <!-- bottom links -->
<div class="border-line"></div>
  <section id="hyperlinks">
    <p class="align-center"><a href="{% url 'containers' %}">Available Containers</a></p>
    <p class="align-center"><a href="{% url 'reallocate' contract.id %}">Reallocate Containers</a></p>
    <p class="align-center"><a href="{% url 'pdf_view' contract.id %}">View PDF</a></p>
    <p class="align-center"><a href="{% url 'grade_a'  %}">GRADE A - WWT</a></p>
    <p class="align-center"><a href="#">Rebalance to New Weights</a></p>
    <p class="align-center"><a href="{% url 'pdf_download' %}">Download PDF</a></p>
  </section>
</div>
<script>
  const total_weight = Number({{ contract.total_weight }});
  const curr_containers = document.querySelectorAll(".curr-containers");
  const pend_containers = document.querySelectorAll(".pend-containers");
  
  for (const container of curr_containers) { 
    const container_weight = Number(container.querySelector(".curr-container-weight").innerHTML)
    const container_percent = container.querySelector(".curr-container-percent")
    container_percent.innerText = Number((container_weight / total_weight) * 100).toFixed(3) + "%"
  }
  for (const container of pend_containers) { 
    const container_weight = Number(container.querySelector(".pend-container-weight").innerHTML)
    const container_percent = container.querySelector(".pend-container-percent")
    container_percent.innerText = Number((container_weight / total_weight) * 100).toFixed(3) + "%"
  }
</script>
{% endblock content %}
